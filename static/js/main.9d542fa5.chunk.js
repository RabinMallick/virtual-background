(this["webpackJsonpvirtual-background"]=this["webpackJsonpvirtual-background"]||[]).push([[0],{298:function(e,t,n){},313:function(e,t){},314:function(e,t){},322:function(e,t){},325:function(e,t){},326:function(e,t){},327:function(e,t){},328:function(e,t,n){"use strict";n.r(t);var r=n(352),o=n(17),a=n.n(o),i=n(147),u=n.n(i),c=n(51),s=n(222),f=n(4),l=n(349),d=n(354),m=(n(298),n(355)),g=n(351),p=n(353),b=n(5),v=n.n(b),_=n(11),E={"640x360":[640,360],"256x256":[256,256],"256x144":[256,144],"160x96":[160,96]};function h(e,t){switch(e){case"meet":return"256x144"===t?"segm_full_v679":"segm_lite_v681";case"mlkit":return"selfiesegmentation_mlkit-256x256-2021_01_19-v1215.f16";default:throw new Error("No TFLite file for this segmentation model: ".concat(e))}}function x(e,t,n,r,o,a,i){var u=r.getContext("2d"),c=Object(f.a)(E[n.inputResolution],2),s=c[0],l=c[1],d=s*l,m=new ImageData(s,l),g=document.createElement("canvas");g.width=s,g.height=l;var p,b=g.getContext("2d"),h=a._getInputMemoryOffset()/4,x=a._getOutputMemoryOffset()/4;function T(){return(T=Object(_.a)(v.a.mark((function e(){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("none"!==t.type&&R(),i(),"none"===t.type){e.next=9;break}if("bodyPix"!==n.model){e.next=8;break}return e.next=6,F();case 6:e.next=9;break;case 8:A();case 9:i(),O();case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(){if(b.drawImage(e.htmlElement,0,0,e.width,e.height,0,0,s,l),"meet"===n.model||"mlkit"===n.model)for(var t=b.getImageData(0,0,s,l),r=0;r<d;r++)a.HEAPF32[h+3*r]=t.data[4*r]/255,a.HEAPF32[h+3*r+1]=t.data[4*r+1]/255,a.HEAPF32[h+3*r+2]=t.data[4*r+2]/255}function F(){return C.apply(this,arguments)}function C(){return(C=Object(_.a)(v.a.mark((function e(){var t,n;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.segmentPerson(g);case 2:for(t=e.sent,console.log(t),console.log("Called"),n=0;n<d;n++)m.data[4*n+3]=t.data[n]?255:0;b.putImageData(m,0,0);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(){a._runInference();for(var e=0;e<d;e++)if("meet"===n.model){var t=a.HEAPF32[x+2*e],r=a.HEAPF32[x+2*e+1],o=Math.max(t,r),i=Math.exp(t-o),u=Math.exp(r-o);m.data[4*e+3]=255*u/(i+u)}else if("mlkit"===n.model){var c=a.HEAPF32[x+e];m.data[4*e+3]=255*c}b.putImageData(m,0,0)}function O(){var n;u.globalCompositeOperation="copy",u.filter="none",(null===(n=p)||void 0===n?void 0:n.smoothSegmentationMask)&&("blur"===t.type?u.filter="blur(8px)":"image"===t.type&&(u.filter="blur(4px)")),"none"!==t.type&&(u.drawImage(g,0,0,s,l,0,0,e.width,e.height),u.globalCompositeOperation="source-in",u.filter="none"),u.drawImage(e.htmlElement,0,0),"blur"===t.type&&(u.globalCompositeOperation="destination-over",u.filter="blur(8px)",u.drawImage(e.htmlElement,0,0))}return{render:function(){return T.apply(this,arguments)},updatePostProcessingConfig:function(e){p=e},cleanUp:function(){}}}var T,R,F,C,A,O,j,U,S,P,k=n(60),M=String.raw;function w(e,t,n,r,o){var a=function(e,t,n){var r=e.createProgram();if(e.attachShader(r,t),e.attachShader(r,n),e.linkProgram(r),!e.getProgramParameter(r,e.LINK_STATUS))throw new Error("Could not link WebGL program: ".concat(e.getProgramInfoLog(r)));return r}(e,t,n),i=e.getAttribLocation(a,"a_position");e.enableVertexAttribArray(i),e.bindBuffer(e.ARRAY_BUFFER,r),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0);var u=e.getAttribLocation(a,"a_texCoord");return e.enableVertexAttribArray(u),e.bindBuffer(e.ARRAY_BUFFER,o),e.vertexAttribPointer(u,2,e.FLOAT,!1,0,0),a}function y(e,t,n){var r=e.createShader(t);if(e.shaderSource(r,n),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw new Error("Could not compile shader: ".concat(e.getShaderInfoLog(r)));return r}function D(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.NEAREST,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:e.NEAREST,i=e.createTexture();return e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,o),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,a),e.texStorage2D(e.TEXTURE_2D,1,t,n,r),i}function L(){return(L=Object(_.a)(v.a.mark((function e(t,n,r,o,a,i,u,c){var s;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.createBuffer(),t.bindBuffer(t.PIXEL_PACK_BUFFER,s),t.bufferData(t.PIXEL_PACK_BUFFER,c.byteLength,t.STREAM_READ),t.readPixels(n,r,o,a,i,u,0),t.bindBuffer(t.PIXEL_PACK_BUFFER,null),e.next=7,I(t,t.PIXEL_PACK_BUFFER,s,0,c);case 7:return t.deleteBuffer(s),e.abrupt("return",c);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e,t,n,r,o,a,i){return B.apply(this,arguments)}function B(){return(B=Object(_.a)(v.a.mark((function e(t,n,r,o,a,i,u){var c,s;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=t.fenceSync(t.SYNC_GPU_COMMANDS_COMPLETE,0),t.flush(),e.next=4,N(t,c);case 4:s=e.sent,t.deleteSync(c),s!==t.WAIT_FAILED&&(t.bindBuffer(n,r),t.getBufferSubData(n,o,a,i,u),t.bindBuffer(n,null));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e,t){return new Promise((function(n){requestAnimationFrame((function r(){var o=e.clientWaitSync(t,0,0);o!==e.WAIT_FAILED?o!==e.TIMEOUT_EXPIRED?n(o):requestAnimationFrame(r):n(o)}))}))}function X(e,t,n,r,o,a){var i=function(e,t,n,r,o,a){var i=M(T||(T=Object(k.a)(["#version 300 es\n\n    precision highp float;\n\n    uniform sampler2D u_inputFrame;\n    uniform sampler2D u_personMask;\n    uniform vec2 u_texelSize;\n\n    in vec2 v_texCoord;\n\n    out vec4 outColor;\n\n    const float offset[5] = float[](0.0, 1.0, 2.0, 3.0, 4.0);\n    const float weight[5] = float[](0.2270270270, 0.1945945946, 0.1216216216,\n      0.0540540541, 0.0162162162);\n\n    void main() {\n      vec4 centerColor = texture(u_inputFrame, v_texCoord);\n      float personMask = texture(u_personMask, v_texCoord).a;\n\n      vec4 frameColor = centerColor * weight[0] * (1.0 - personMask);\n\n      for (int i = 1; i < 5; i++) {\n        vec2 offset = vec2(offset[i]) * u_texelSize;\n\n        vec2 texCoord = v_texCoord + offset;\n        frameColor += texture(u_inputFrame, texCoord) * weight[i] *\n          (1.0 - texture(u_personMask, texCoord).a);\n\n        texCoord = v_texCoord - offset;\n        frameColor += texture(u_inputFrame, texCoord) * weight[i] *\n          (1.0 - texture(u_personMask, texCoord).a);\n      }\n      outColor = vec4(frameColor.rgb + (1.0 - frameColor.a) * centerColor.rgb, 1.0);\n    }\n  "]))),u=.5,c=a.width*u,s=a.height*u,f=1/c,l=1/s,d=y(e,e.FRAGMENT_SHADER,i),m=w(e,t,d,n,r),g=e.getUniformLocation(m,"u_inputFrame"),p=e.getUniformLocation(m,"u_personMask"),b=e.getUniformLocation(m,"u_texelSize"),v=D(e,e.RGBA8,c,s,e.NEAREST,e.LINEAR),_=D(e,e.RGBA8,c,s,e.NEAREST,e.LINEAR),E=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,E),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,v,0);var h=e.createFramebuffer();function x(){e.viewport(0,0,c,s),e.useProgram(m),e.uniform1i(g,0),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,o);for(var t=0;t<3;t++)e.uniform2f(b,0,l),e.bindFramebuffer(e.FRAMEBUFFER,E),e.drawArrays(e.TRIANGLE_STRIP,0,4),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,v),e.uniform1i(g,2),e.uniform2f(b,f,0),e.bindFramebuffer(e.FRAMEBUFFER,h),e.drawArrays(e.TRIANGLE_STRIP,0,4),e.bindTexture(e.TEXTURE_2D,_)}function R(){e.deleteFramebuffer(h),e.deleteFramebuffer(E),e.deleteTexture(_),e.deleteTexture(v),e.deleteProgram(m),e.deleteShader(d)}return e.bindFramebuffer(e.FRAMEBUFFER,h),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,_,0),e.useProgram(m),e.uniform1i(p,1),{render:x,cleanUp:R}}(e,t,n,r,o,a),u=function(e,t,n,r){var o=M(R||(R=Object(k.a)(["#version 300 es\n\n    in vec2 a_position;\n    in vec2 a_texCoord;\n\n    out vec2 v_texCoord;\n\n    void main() {\n      // Flipping Y is required when rendering to canvas\n      gl_Position = vec4(a_position * vec2(1.0, -1.0), 0.0, 1.0);\n      v_texCoord = a_texCoord;\n    }\n  "]))),a=M(F||(F=Object(k.a)(["#version 300 es\n\n    precision highp float;\n\n    uniform sampler2D u_inputFrame;\n    uniform sampler2D u_personMask;\n    uniform sampler2D u_blurredInputFrame;\n    uniform vec2 u_coverage;\n\n    in vec2 v_texCoord;\n\n    out vec4 outColor;\n\n    void main() {\n      vec3 color = texture(u_inputFrame, v_texCoord).rgb;\n      vec3 blurredColor = texture(u_blurredInputFrame, v_texCoord).rgb;\n      float personMask = texture(u_personMask, v_texCoord).a;\n      personMask = smoothstep(u_coverage.x, u_coverage.y, personMask);\n      outColor = vec4(mix(blurredColor, color, personMask), 1.0);\n    }\n  "]))),i=r.width,u=r.height,c=y(e,e.VERTEX_SHADER,o),s=y(e,e.FRAGMENT_SHADER,a),f=w(e,c,s,t,n),l=e.getUniformLocation(f,"u_inputFrame"),d=e.getUniformLocation(f,"u_personMask"),m=e.getUniformLocation(f,"u_blurredInputFrame"),g=e.getUniformLocation(f,"u_coverage");function p(){e.viewport(0,0,i,u),e.useProgram(f),e.bindFramebuffer(e.FRAMEBUFFER,null),e.drawArrays(e.TRIANGLE_STRIP,0,4)}function b(t){e.useProgram(f),e.uniform2f(g,t[0],t[1])}function v(){e.deleteProgram(f),e.deleteShader(s),e.deleteShader(c)}return e.useProgram(f),e.uniform1i(l,0),e.uniform1i(d,1),e.uniform1i(m,2),e.uniform2f(g,0,1),{render:p,updateCoverage:b,cleanUp:v}}(e,n,r,a);return{render:function(){i.render(),u.render()},updateCoverage:function(e){u.updateCoverage(e)},cleanUp:function(){u.cleanUp(),i.cleanUp()}}}function W(e,t,n,r,o,a){var i=M(U||(U=Object(k.a)(["#version 300 es\n\n    precision highp float;\n\n    uniform sampler2D u_inputFrame;\n\n    in vec2 v_texCoord;\n\n    out vec4 outColor;\n\n    void main() {\n      outColor = texture(u_inputFrame, v_texCoord);\n    }\n  "]))),u=a._getInputMemoryOffset()/4,c=Object(f.a)(E[o.inputResolution],2),s=c[0],l=c[1],d=s*l,m=y(e,e.FRAGMENT_SHADER,i),g=w(e,t,m,n,r),p=e.getUniformLocation(g,"u_inputFrame"),b=D(e,e.RGBA8,s,l),v=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,v),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,b,0);var _=new Uint8Array(4*d);return e.useProgram(g),e.uniform1i(p,0),{render:function(){e.viewport(0,0,s,l),e.useProgram(g),e.bindFramebuffer(e.FRAMEBUFFER,v),e.drawArrays(e.TRIANGLE_STRIP,0,4),function(e,t,n,r,o,a,i,u){L.apply(this,arguments)}(e,0,0,s,l,e.RGBA,e.UNSIGNED_BYTE,_);for(var t=0;t<d;t++){var n=u+3*t,r=4*t;a.HEAPF32[n]=_[r]/255,a.HEAPF32[n+1]=_[r+1]/255,a.HEAPF32[n+2]=_[r+2]/255}},cleanUp:function(){e.deleteFramebuffer(v),e.deleteTexture(b),e.deleteProgram(g),e.deleteShader(m)}}}function H(e,t,n,r,o,a,i){var u=M(P||(P=Object(k.a)(["#version 300 es\n\n    in vec2 a_position;\n    in vec2 a_texCoord;\n\n    out vec2 v_texCoord;\n\n    void main() {\n      gl_Position = vec4(a_position, 0.0, 1.0);\n      v_texCoord = a_texCoord;\n    }\n  "]))),c=e.width,s=e.height,l=Object(f.a)(E[r.inputResolution],2),d=l[0],m=l[1],g=o.getContext("webgl2"),p=y(g,g.VERTEX_SHADER,u),b=g.createVertexArray();g.bindVertexArray(b);var h=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,h),g.bufferData(g.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),g.STATIC_DRAW);var x=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,x),g.bufferData(g.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,1,1]),g.STATIC_DRAW);var T=g.createTexture();g.bindTexture(g.TEXTURE_2D,T),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.NEAREST),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.NEAREST);var R=D(g,g.RGBA8,d,m),F=D(g,g.RGBA8,c,s),U=W(g,p,h,x,r,a),L="meet"===r.model?function(e,t,n,r,o,a,i){var u=M(S||(S=Object(k.a)(["#version 300 es\n\n    precision highp float;\n\n    uniform sampler2D u_inputSegmentation;\n\n    in vec2 v_texCoord;\n\n    out vec4 outColor;\n\n    void main() {\n      vec2 segmentation = texture(u_inputSegmentation, v_texCoord).rg;\n      float shift = max(segmentation.r, segmentation.g);\n      float backgroundExp = exp(segmentation.r - shift);\n      float personExp = exp(segmentation.g - shift);\n      outColor = vec4(vec3(0.0), personExp / (backgroundExp + personExp));\n    }\n  "]))),c=a._getOutputMemoryOffset()/4,s=Object(f.a)(E[o.inputResolution],2),l=s[0],d=s[1],m=y(e,e.FRAGMENT_SHADER,u),g=w(e,t,m,n,r),p=e.getUniformLocation(g,"u_inputSegmentation"),b=D(e,e.RG32F,l,d),v=e.createFramebuffer();return e.bindFramebuffer(e.FRAMEBUFFER,v),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,i,0),e.useProgram(g),e.uniform1i(p,1),{render:function(){e.viewport(0,0,l,d),e.useProgram(g),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,b),e.texSubImage2D(e.TEXTURE_2D,0,0,0,l,d,e.RG,e.FLOAT,a.HEAPF32,c),e.bindFramebuffer(e.FRAMEBUFFER,v),e.drawArrays(e.TRIANGLE_STRIP,0,4)},cleanUp:function(){e.deleteFramebuffer(v),e.deleteTexture(b),e.deleteProgram(g),e.deleteShader(m)}}}(g,p,h,x,r,a,R):function(e,t,n,r,o,a,i){var u=M(j||(j=Object(k.a)(["#version 300 es\n\n    precision highp float;\n\n    uniform sampler2D u_inputSegmentation;\n\n    in vec2 v_texCoord;\n\n    out vec4 outColor;\n\n    void main() {\n      float segmentation = texture(u_inputSegmentation, v_texCoord).r;\n      outColor = vec4(vec3(0.0), segmentation);\n    }\n  "]))),c=a._getOutputMemoryOffset()/4,s=Object(f.a)(E[o.inputResolution],2),l=s[0],d=s[1],m=y(e,e.FRAGMENT_SHADER,u),g=w(e,t,m,n,r),p=e.getUniformLocation(g,"u_inputSegmentation"),b=D(e,e.R32F,l,d),v=e.createFramebuffer();return e.bindFramebuffer(e.FRAMEBUFFER,v),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,i,0),e.useProgram(g),e.uniform1i(p,1),{render:function(){e.viewport(0,0,l,d),e.useProgram(g),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,b),e.texSubImage2D(e.TEXTURE_2D,0,0,0,l,d,e.RED,e.FLOAT,a.HEAPF32,c),e.bindFramebuffer(e.FRAMEBUFFER,v),e.drawArrays(e.TRIANGLE_STRIP,0,4)},cleanUp:function(){e.deleteFramebuffer(v),e.deleteTexture(b),e.deleteProgram(g),e.deleteShader(m)}}}(g,p,h,x,r,a,R),I=function(e,t,n,r,o,a,i,u){var c=M(O||(O=Object(k.a)(["#version 300 es\n\n    precision highp float;\n\n    uniform sampler2D u_inputFrame;\n    uniform sampler2D u_segmentationMask;\n    uniform vec2 u_texelSize;\n    uniform float u_step;\n    uniform float u_radius;\n    uniform float u_offset;\n    uniform float u_sigmaTexel;\n    uniform float u_sigmaColor;\n\n    in vec2 v_texCoord;\n\n    out vec4 outColor;\n\n    float gaussian(float x, float sigma) {\n      float coeff = -0.5 / (sigma * sigma * 4.0 + 1.0e-6);\n      return exp((x * x) * coeff);\n    }\n\n    void main() {\n      vec2 centerCoord = v_texCoord;\n      vec3 centerColor = texture(u_inputFrame, centerCoord).rgb;\n      float newVal = 0.0;\n\n      float spaceWeight = 0.0;\n      float colorWeight = 0.0;\n      float totalWeight = 0.0;\n\n      // Subsample kernel space.\n      for (float i = -u_radius + u_offset; i <= u_radius; i += u_step) {\n        for (float j = -u_radius + u_offset; j <= u_radius; j += u_step) {\n          vec2 shift = vec2(j, i) * u_texelSize;\n          vec2 coord = vec2(centerCoord + shift);\n          vec3 frameColor = texture(u_inputFrame, coord).rgb;\n          float outVal = texture(u_segmentationMask, coord).a;\n\n          spaceWeight = gaussian(distance(centerCoord, coord), u_sigmaTexel);\n          colorWeight = gaussian(distance(centerColor, frameColor), u_sigmaColor);\n          totalWeight += spaceWeight * colorWeight;\n\n          newVal += spaceWeight * colorWeight * outVal;\n        }\n      }\n      newVal /= totalWeight;\n\n      outColor = vec4(vec3(0.0), newVal);\n    }\n  "]))),s=Object(f.a)(E[a.inputResolution],2),l=s[0],d=s[1],m=u.width,g=u.height,p=1/m,b=1/g,v=y(e,e.FRAGMENT_SHADER,c),_=w(e,t,v,n,r),h=e.getUniformLocation(_,"u_inputFrame"),x=e.getUniformLocation(_,"u_segmentationMask"),T=e.getUniformLocation(_,"u_texelSize"),R=e.getUniformLocation(_,"u_step"),F=e.getUniformLocation(_,"u_radius"),C=e.getUniformLocation(_,"u_offset"),A=e.getUniformLocation(_,"u_sigmaTexel"),j=e.getUniformLocation(_,"u_sigmaColor"),U=e.createFramebuffer();function S(t){t*=Math.max(m/l,g/d);var n=Math.max(1,.66*Math.sqrt(t)),r=t,o=n>1?.5*n:0,a=Math.max(p,b)*t;e.useProgram(_),e.uniform1f(R,n),e.uniform1f(F,r),e.uniform1f(C,o),e.uniform1f(A,a)}function P(t){e.useProgram(_),e.uniform1f(j,t)}return e.bindFramebuffer(e.FRAMEBUFFER,U),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,i,0),e.useProgram(_),e.uniform1i(h,0),e.uniform1i(x,1),e.uniform2f(T,p,b),S(0),P(0),{render:function(){e.viewport(0,0,m,g),e.useProgram(_),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,o),e.bindFramebuffer(e.FRAMEBUFFER,U),e.drawArrays(e.TRIANGLE_STRIP,0,4)},updateSigmaSpace:S,updateSigmaColor:P,cleanUp:function(){e.deleteFramebuffer(U),e.deleteProgram(_),e.deleteShader(v)}}}(g,p,h,x,R,r,F,o),B="blur"===n.type?X(g,p,h,x,F,o):function(e,t,n,r,o,a){var i=M(C||(C=Object(k.a)(["#version 300 es\n\n    uniform vec2 u_backgroundScale;\n    uniform vec2 u_backgroundOffset;\n\n    in vec2 a_position;\n    in vec2 a_texCoord;\n\n    out vec2 v_texCoord;\n    out vec2 v_backgroundCoord;\n\n    void main() {\n      // Flipping Y is required when rendering to canvas\n      gl_Position = vec4(a_position * vec2(1.0, -1.0), 0.0, 1.0);\n      v_texCoord = a_texCoord;\n      v_backgroundCoord = a_texCoord * u_backgroundScale + u_backgroundOffset;\n    }\n  "]))),u=M(A||(A=Object(k.a)(["#version 300 es\n\n    precision highp float;\n\n    uniform sampler2D u_inputFrame;\n    uniform sampler2D u_personMask;\n    uniform sampler2D u_background;\n    uniform vec2 u_coverage;\n    uniform float u_lightWrapping;\n    uniform float u_blendMode;\n\n    in vec2 v_texCoord;\n    in vec2 v_backgroundCoord;\n\n    out vec4 outColor;\n\n    vec3 screen(vec3 a, vec3 b) {\n      return 1.0 - (1.0 - a) * (1.0 - b);\n    }\n\n    vec3 linearDodge(vec3 a, vec3 b) {\n      return a + b;\n    }\n\n    void main() {\n      vec3 frameColor = texture(u_inputFrame, v_texCoord).rgb;\n      vec3 backgroundColor = texture(u_background, v_backgroundCoord).rgb;\n      float personMask = texture(u_personMask, v_texCoord).a;\n      float lightWrapMask = 1.0 - max(0.0, personMask - u_coverage.y) / (1.0 - u_coverage.y);\n      vec3 lightWrap = u_lightWrapping * lightWrapMask * backgroundColor;\n      frameColor = u_blendMode * linearDodge(frameColor, lightWrap) +\n        (1.0 - u_blendMode) * screen(frameColor, lightWrap);\n      personMask = smoothstep(u_coverage.x, u_coverage.y, personMask);\n      outColor = vec4(frameColor * personMask + backgroundColor * (1.0 - personMask), 1.0);\n    }\n  "]))),c=a.width,s=a.height,f=c/s,l=y(e,e.VERTEX_SHADER,i),d=y(e,e.FRAGMENT_SHADER,u),m=w(e,l,d,t,n),g=e.getUniformLocation(m,"u_backgroundScale"),p=e.getUniformLocation(m,"u_backgroundOffset"),b=e.getUniformLocation(m,"u_inputFrame"),v=e.getUniformLocation(m,"u_personMask"),_=e.getUniformLocation(m,"u_background"),E=e.getUniformLocation(m,"u_coverage"),h=e.getUniformLocation(m,"u_lightWrapping"),x=e.getUniformLocation(m,"u_blendMode");e.useProgram(m),e.uniform2f(g,1,1),e.uniform2f(p,0,0),e.uniform1i(b,0),e.uniform1i(v,1),e.uniform2f(E,0,1),e.uniform1f(h,0),e.uniform1f(x,0);var T=null;function R(t){T=D(e,e.RGBA8,t.naturalWidth,t.naturalHeight,e.LINEAR,e.LINEAR),e.texSubImage2D(e.TEXTURE_2D,0,0,0,t.naturalWidth,t.naturalHeight,e.RGBA,e.UNSIGNED_BYTE,t);var n=0,r=0,o=t.naturalWidth,a=t.naturalHeight;o/a<f?(a=o/f,r=(t.naturalHeight-a)/2):(o=a*f,n=(t.naturalWidth-o)/2);var i=o/t.naturalWidth,u=a/t.naturalHeight;n/=t.naturalWidth,r/=t.naturalHeight,e.uniform2f(g,i,u),e.uniform2f(p,n,r)}return(null===o||void 0===o?void 0:o.complete)?R(o):o&&(o.onload=function(){R(o)}),{render:function(){e.viewport(0,0,c,s),e.useProgram(m),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,r),null!==T&&(e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,T),e.uniform1i(_,2)),e.bindFramebuffer(e.FRAMEBUFFER,null),e.drawArrays(e.TRIANGLE_STRIP,0,4)},updateCoverage:function(t){e.useProgram(m),e.uniform2f(E,t[0],t[1])},updateLightWrapping:function(t){e.useProgram(m),e.uniform1f(h,t)},updateBlendMode:function(t){e.useProgram(m),e.uniform1f(x,"screen"===t?0:1)},cleanUp:function(){e.deleteTexture(T),e.deleteProgram(m),e.deleteShader(d),e.deleteShader(l)}}}(g,h,x,F,t,o);function N(){return(N=Object(_.a)(v.a.mark((function t(){return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:g.clearColor(0,0,0,0),g.clear(g.COLOR_BUFFER_BIT),g.activeTexture(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,T),g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,e.htmlElement),g.bindVertexArray(b),U.render(),i(),a._runInference(),i(),L.render(),I.render(),B.render();case 13:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return{render:function(){return N.apply(this,arguments)},updatePostProcessingConfig:function(e){if(I.updateSigmaSpace(e.jointBilateralFilter.sigmaSpace),I.updateSigmaColor(e.jointBilateralFilter.sigmaColor),"image"===n.type){var t=B;t.updateCoverage(e.coverage),t.updateLightWrapping(e.lightWrapping),t.updateBlendMode(e.blendMode)}else if("blur"===n.type){B.updateCoverage(e.coverage)}else{var r=B;r.updateCoverage([0,.9999]),r.updateLightWrapping(0)}},cleanUp:function(){B.cleanUp(),I.cleanUp(),L.cleanUp(),U.cleanUp(),g.deleteTexture(F),g.deleteTexture(R),g.deleteTexture(T),g.deleteBuffer(x),g.deleteBuffer(h),g.deleteVertexArray(b),g.deleteShader(p)}}}var G=function(e,t,n,r,a){var i=Object(o.useState)(null),u=Object(f.a)(i,2),c=u[0],s=u[1],l=Object(o.useRef)(null),d=Object(o.useRef)(null),m=Object(o.useState)(0),g=Object(f.a)(m,2),p=g[0],b=g[1],E=Object(o.useState)([]),h=Object(f.a)(E,2),T=h[0],R=h[1];return Object(o.useEffect)((function(){var o,i=!0,u=0,c=0,f=0,m=0,g=[],p="webgl2"===n.pipeline?H(e,l.current,t,n,d.current,a,F):x(e,t,n,d.current,r,a,F);function E(){return h.apply(this,arguments)}function h(){return(h=Object(_.a)(v.a.mark((function e(){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=2;break}return e.abrupt("return");case 2:return T(),e.next=5,p.render();case 5:C(),o=requestAnimationFrame(E);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(){c=Date.now()}function F(){var e=Date.now();g[f]=e-c,c=e,f++}function C(){var e=Date.now();g[f]=e-c,m++,console.log(m),e>=u+1e3&&(b(1e3*m/(e-u)),R(g),u=e,m=0),f=0}return E(),console.log("Animation started:",e,t,n),s(p),function(){i=!1,cancelAnimationFrame(o),p.cleanUp(),console.log("Animation stopped:",e,t,n),s(null)}}),[e,t,n,r,a]),{pipeline:c,backgroundImageRef:l,canvasRef:d,fps:p,durations:T}},V=n(42);var Y=Object(l.a)((function(e){return Object(d.a)({root:{flex:1,position:"relative"},render:{position:"absolute",width:"100%",height:"100%",objectFit:"cover"},stats:{position:"absolute",top:0,right:0,left:0,textAlign:"center",backgroundColor:"rgba(0, 0, 0, 0.48)",color:e.palette.common.white}})})),z=function(e){var t=Y(),n=G(e.sourcePlayback,e.backgroundConfig,e.segmentationConfig,e.bodyPix,e.tflite),r=n.pipeline,i=n.backgroundImageRef,u=n.canvasRef,c=n.fps,s=Object(f.a)(n.durations,3),l=s[0],d=s[1],m=s[2];Object(o.useEffect)((function(){r&&r.updatePostProcessingConfig(e.postProcessingConfig)}),[r,e.postProcessingConfig]);var g=["resizing ".concat(l,"ms"),"inference ".concat(d,"ms"),"post-processing ".concat(m,"ms")],b=("".concat(Math.round(c)," fps (").concat(g.join(", "),")"),a.a.useState(null)),v=Object(f.a)(b,2),_=(v[0],v[1]);return a.a.useRef(null),a.a.useCallback((function(){document.getElementById("canvas");var e=u.current.toDataURL();_(e)}),[u,_]),Object(V.jsx)("div",{style:{width:"100%",height:"100vh",position:"relative"},children:Object(V.jsxs)("div",{className:"".concat(t.root," container"),children:["image"===e.backgroundConfig.type&&Object(V.jsx)("img",{ref:i,className:t.render,src:e.backgroundConfig.url,alt:"",hidden:"webgl2"===e.segmentationConfig.pipeline}),Object(V.jsx)("canvas",{id:"canvas",ref:u,className:t.render,width:e.sourcePlayback.width,height:e.sourcePlayback.height},e.segmentationConfig.pipeline),Object(V.jsx)(p.a,{variant:"contained",className:"skip-btn",children:"Next"})]})})},q=n(350),K=n(268),J=n.n(K);var Q=Object(l.a)((function(e){var t;return Object(d.a)({root:(t={position:"relative",display:"flex",justifyContent:"center",alignItems:"center"},Object(c.a)(t,e.breakpoints.down("xs"),{width:0,overflow:"hidden"}),Object(c.a)(t,e.breakpoints.up("sm"),{flex:1,borderRightWidth:1,borderRightStyle:"solid",borderRightColor:e.palette.divider}),t),sourcePlayback:{position:"absolute",width:"100%",height:"100%",objectFit:"cover"}})})),Z=function(e){var t=Q(),n=Object(o.useState)(),r=Object(f.a)(n,2),a=r[0],i=r[1],u=Object(o.useState)(!1),c=Object(f.a)(u,2),s=c[0],l=c[1],d=Object(o.useState)(!1),m=Object(f.a)(d,2),g=m[0],p=m[1],b=Object(o.useRef)(null);return Object(o.useEffect)((function(){i(void 0),l(!0),p(!1),setTimeout((function(){return i(e.sourceConfig.url)}))}),[e.sourceConfig]),Object(o.useEffect)((function(){function t(){return(t=Object(_.a)(v.a.mark((function e(){var t,n;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={video:!0},e.next=4,navigator.mediaDevices.getUserMedia(t);case 4:if(n=e.sent,!b.current){e.next=9;break}return b.current.srcObject=n,console.log(b),e.abrupt("return");case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.error("Error opening video camera.",e.t0);case 14:l(!1),p(!0);case 16:case"end":return e.stop()}}),e,null,[[0,11]])})))).apply(this,arguments)}"camera"===e.sourceConfig.type?function(){t.apply(this,arguments)}():b.current&&(b.current.srcObject=null)}),[e.sourceConfig]),Object(V.jsxs)("div",{className:t.root,children:[s&&Object(V.jsx)(q.a,{}),"image"===e.sourceConfig.type?Object(V.jsx)("img",{className:t.sourcePlayback,src:a,hidden:s,alt:"",onLoad:function(t){var n=t.target;e.onLoad({htmlElement:n,width:n.naturalWidth,height:n.naturalHeight}),l(!1)}}):g?Object(V.jsx)(J.a,{fontSize:"large"}):Object(V.jsx)("video",{ref:b,className:t.sourcePlayback,src:a,hidden:s,autoPlay:!0,playsInline:!0,controls:!1,muted:!0,loop:!0,onLoadedData:function(t){var n=t.target;console.log("Handle",n),e.onLoad({htmlElement:n,width:n.videoWidth,height:n.videoHeight}),l(!1)}})]})};var $=Object(l.a)((function(e){var t,n=["".concat(e.spacing(52),"px"),"100vh - ".concat(e.spacing(2),"px")];return Object(d.a)({root:(t={minHeight:"calc(min(".concat(n.join(", "),"))"),display:"flex",overflow:"hidden"},Object(c.a)(t,e.breakpoints.up("md"),{gridColumnStart:1,gridColumnEnd:3}),Object(c.a)(t,e.breakpoints.up("lg"),{gridRowStart:1,gridRowEnd:3}),t),noOutput:{flex:1,display:"flex",justifyContent:"center",alignItems:"center"},avatar:{width:e.spacing(20),height:e.spacing(20)}})})),ee=function(e){var t=$(),n=Object(o.useState)(),r=Object(f.a)(n,2),a=r[0],i=r[1];return Object(o.useEffect)((function(){i(void 0)}),[e.sourceConfig]),Object(V.jsxs)(g.a,{className:t.root,style:{width:"100%"},children:[Object(V.jsx)(Z,{sourceConfig:e.sourceConfig,onLoad:i}),a&&e.bodyPix&&e.tflite?Object(V.jsx)(z,{sourcePlayback:a,backgroundConfig:e.backgroundConfig,segmentationConfig:e.segmentationConfig,postProcessingConfig:e.postProcessingConfig,bodyPix:e.bodyPix,tflite:e.tflite}):Object(V.jsx)("div",{className:t.noOutput,children:Object(V.jsx)(m.a,{className:t.avatar})})]})},te=["asset-6","porch-691330_1280","saxon-switzerland-539418_1280","shibuyasky-4768679_1280"].map((function(e){return"".concat("/virtual-background","/backgrounds/").concat(e,".png")})),ne=n(269),re=n(291);var oe=function(){var e=Object(o.useState)(),t=Object(f.a)(e,2),n=t[0],r=t[1];return Object(o.useEffect)((function(){function e(){return(e=Object(_.a)(v.a.mark((function e(){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Loading TensorFlow.js and BodyPix segmentation model"),e.next=3,re.a();case 3:return e.t0=r,e.next=6,ne.a();case 6:e.t1=e.sent,(0,e.t0)(e.t1),console.log("TensorFlow.js and BodyPix loaded");case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),n};var ae=function(e){var t=Object(o.useState)(),n=Object(f.a)(t,2),r=n[0],a=n[1],i=Object(o.useState)(),u=Object(f.a)(i,2),c=u[0],s=u[1],l=Object(o.useState)(),d=Object(f.a)(l,2),m=d[0],g=d[1],p=Object(o.useState)(!1),b=Object(f.a)(p,2),E=b[0],x=b[1];return Object(o.useEffect)((function(){function e(){return(e=Object(_.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return createTFLiteModule().then(a),e.prev=1,e.next=4,createTFLiteSIMDModule();case 4:t=e.sent,s(t),x(!0),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),console.warn("Failed to create TFLite SIMD WebAssembly module.",e.t0);case 12:case"end":return e.stop()}}),e,null,[[1,9]])})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),Object(o.useEffect)((function(){function t(){return(t=Object(_.a)(v.a.mark((function t(){var n,o,a,i,u;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(!r||E&&!c||!E&&"wasmSimd"===e.backend||"meet"!==e.model&&"mlkit"!==e.model)){t.next=2;break}return t.abrupt("return");case 2:if(g(void 0),n="wasmSimd"===e.backend?c:r){t.next=6;break}throw new Error("TFLite backend unavailable: ".concat(e.backend));case 6:return o=h(e.model,e.inputResolution),console.log("Loading tflite model:",o),t.next=10,fetch("".concat("/virtual-background","/models/").concat(o,".tflite"));case 10:return a=t.sent,t.next=13,a.arrayBuffer();case 13:i=t.sent,console.log("Model buffer size:",i.byteLength),u=n._getModelBufferMemoryOffset(),console.log("Model buffer memory offset:",u),console.log("Loading model buffer..."),n.HEAPU8.set(new Uint8Array(i),u),console.log("_loadModel result:",n._loadModel(i.byteLength)),console.log("Input memory offset:",n._getInputMemoryOffset()),console.log("Input height:",n._getInputHeight()),console.log("Input width:",n._getInputWidth()),console.log("Input channels:",n._getInputChannelCount()),console.log("Output memory offset:",n._getOutputMemoryOffset()),console.log("Output height:",n._getOutputHeight()),console.log("Output width:",n._getOutputWidth()),console.log("Output channels:",n._getOutputChannelCount()),g(n);case 29:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}),[r,c,E,e.model,e.backend,e.inputResolution]),{tflite:m,isSIMDSupported:E}};var ie=Object(l.a)((function(e){var t;return Object(d.a)({root:(t={display:"grid"},Object(c.a)(t,e.breakpoints.up("xs"),{margin:e.spacing(1),gap:e.spacing(1),gridTemplateColumns:"1fr"}),Object(c.a)(t,e.breakpoints.up("md"),{margin:e.spacing(2),gap:e.spacing(2),gridTemplateColumns:"repeat(2, 1fr)"}),Object(c.a)(t,e.breakpoints.up("lg"),{gridTemplateColumns:"repeat(3, 1fr)"}),t),resourceSelectionCards:{display:"flex",flexDirection:"column"}})})),ue=function(){var e=ie(),t=Object(o.useState)({type:"camera"}),n=Object(f.a)(t,2),r=n[0],a=(n[1],Object(o.useState)({type:"image",url:te[0]})),i=Object(f.a)(a,2),u=i[0],c=(i[1],Object(o.useState)({model:"meet",backend:"wasm",inputResolution:"160x96",pipeline:"webgl2"})),l=Object(f.a)(c,2),d=l[0],m=l[1],g=Object(o.useState)({smoothSegmentationMask:!0,jointBilateralFilter:{sigmaSpace:1,sigmaColor:.1},coverage:[.5,.75],lightWrapping:.3,blendMode:"screen"}),p=Object(f.a)(g,2),b=p[0],v=(p[1],oe()),_=ae(d),E=_.tflite,h=_.isSIMDSupported;return Object(o.useEffect)((function(){m((function(e){return"wasm"===e.backend&&h?Object(s.a)(Object(s.a)({},e),{},{backend:"wasmSimd"}):e}))}),[h]),Object(V.jsx)("div",{className:e.root,style:{margin:"0",width:"100%",height:"100vh"},children:Object(V.jsx)(ee,{sourceConfig:r,backgroundConfig:u,segmentationConfig:d,postProcessingConfig:b,bodyPix:v,tflite:E})})},ce=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,357)).then((function(t){var n=t.getCLS,r=t.getFID,o=t.getFCP,a=t.getLCP,i=t.getTTFB;n(e),r(e),o(e),a(e),i(e)}))};u.a.render(Object(V.jsxs)(a.a.StrictMode,{children:[Object(V.jsx)(r.a,{}),Object(V.jsx)(ue,{})]}),document.getElementById("root")),ce()}},[[328,1,2]]]);
//# sourceMappingURL=main.9d542fa5.chunk.js.map